<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Estoque</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-4">

    <h2>Controle de Estoque</h2>

    <!-- Formulário para adicionar item -->
    <form method="POST" class="row g-3 mb-4">
        <div class="col-md-5">
            <label class="form-label">Nome do item</label>
            <input type="text" name="nome" class="form-control" required>
        </div>

        <div class="col-md-2">
            <label class="form-label">Quantidade</label>
            <input type="number" name="quantidade" class="form-control" min="1" required>
        </div>

        <div class="col-md-3">
            <label class="form-label">Preço Unitário (R$)</label>
            <input type="number" step="0.01" name="preco_unitario" class="form-control" min="0" required>
        </div>

        <div class="col-md-2 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">Adicionar</button>
        </div>
    </form>

    <!-- Abas de filtro por dia -->
    <ul class="nav nav-tabs mb-3">
        <li class="nav-item">
            <a class="nav-link {% if dia_label == 'Hoje' %}active{% endif %}"
               href="{{ url_for('estoque', dia=hoje_str) }}">Hoje</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {% if dia_label == 'Ontem' %}active{% endif %}"
               href="{{ url_for('estoque', dia=ontem_str) }}">Ontem</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {% if dia_label == 'Todos' %}active{% endif %}"
               href="{{ url_for('estoque') }}">Todos</a>
        </li>
    </ul>

    <h4>Movimentação - {{ dia_label }}</h4>

    <!-- Tabela de movimentações -->
    <table class="table table-bordered table-striped mb-4">
        <thead>
            <tr>
                <th>Produto</th>
                <th>Tipo</th>
                <th>Quantidade</th>
                <th>Data</th>
            </tr>
        </thead>
        <tbody>
        {% for mov in movimentos %}
            <tr>
                <td>{{ mov.item.nome if mov.item else '---' }}</td>
                <td>
                    {% if mov.tipo == 'entrada' %}
                        <span class="badge bg-success">Entrada</span>
                    {% else %}
                        <span class="badge bg-danger">Saída</span>
                    {% endif %}
                </td>
                <td>{{ mov.quantidade }}</td>
                <td>{{ mov.data.strftime('%d/%m/%Y') }}</td>
            </tr>
        {% else %}
            <tr>
                <td colspan="4" class="text-center">Nenhuma movimentação</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <!-- Tabela de saldo atual -->
    <h4>Saldo Atual do Estoque</h4>
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Produto</th>
                <th>Quantidade Atual</th>
                <th>Preço Unitário</th>
                <th>Data de Entrada</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
        {% for item in itens %}
            <tr>
                <td>{{ item.nome }}</td>
                <td>{{ item.quantidade }}</td>
                <td>R$ {{ "%.2f"|format(item.preco_unitario or 0) }}</td>
                <td>{{ item.data_entrada.strftime('%d/%m/%Y') }}</td>
                <td>
                    <a href="{{ url_for('editar_estoque', id=item.id) }}" class="btn btn-warning btn-sm">Editar</a>
                    <a href="{{ url_for('excluir_estoque', id=item.id) }}" class="btn btn-danger btn-sm"
                       onclick="return confirm('Excluir este item?')">Excluir</a>

                    <!-- Form para remover quantidade -->
                    <form action="{{ url_for('remover_estoque', id=item.id) }}" method="POST" class="d-inline">
                        <input type="number" name="quantidade" min="1" max="{{ item.quantidade }}"
                               class="form-control form-control-sm d-inline" style="width:80px;" required>
                        <button type="submit" class="btn btn-secondary btn-sm">Remover Qtd</button>
                    </form>
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="5" class="text-center">Nenhum produto no estoque</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <a href="{{ url_for('index') }}" class="btn btn-secondary mt-2">Voltar</a>
	<a href="{{ url_for('limpar_estoque') }}" class="btn btn-danger"
   onclick="return confirm('Tem certeza que deseja apagar todas as movimentações do estoque e saídas financeiras?')">
   Limpar Movimentações
</a>


</body>
</html>
